{% comment %}
  Sección: anchor-navigation-menu.liquid
  Propósito: Crear el menú de navegación flotante para las anclas
  Ubicación: extensions/navegacion-mejorada/sections/anchor-navigation-menu.liquid
  
  Esta es una SECCIÓN completa que se agrega al tema desde el editor.
  Genera un menú de navegación que se llena automáticamente con las anclas.
{% endcomment %}

{% comment %}
  Contenedor principal del menú de navegación
{% endcomment %}
<div class="anchor-nav-section" 
     data-section-id="{{ section.id }}"
     data-section-type="anchor-navigation">
  
  {% comment %}
    Renderizar el snippet de navegación con todas las configuraciones
  {% endcomment %}
  {% render 'anchor-navigation',
    nav_position: section.settings.nav_position,
    nav_style: section.settings.nav_style,
    show_labels: section.settings.show_labels,
    header_offset: section.settings.header_offset,
    scroll_duration: section.settings.scroll_duration,
    nav_background: section.settings.nav_background,
    nav_color: section.settings.nav_color,
    nav_active_color: section.settings.nav_active_color,
    hide_on_mobile: section.settings.hide_on_mobile,
    auto_hide: section.settings.auto_hide,
    show_progress: section.settings.show_progress
  %}
  
  {% comment %}
    Indicador de progreso opcional
  {% endcomment %}
  {% if section.settings.show_progress %}
    <div class="scroll-progress-indicator">
      <div class="scroll-progress-bar"></div>
    </div>
  {% endif %}
</div>

{% comment %}
  Estilos personalizados basados en configuración
{% endcomment %}
<style>
  /* Variables CSS personalizables */
  #shopify-section-{{ section.id }} {
    --nav-background: {{ section.settings.nav_background }};
    --nav-color: {{ section.settings.nav_color }};
    --nav-active-color: {{ section.settings.nav_active_color }};
    --nav-hover-color: {{ section.settings.nav_hover_color }};
    --nav-transition-speed: {{ section.settings.transition_speed }}ms;
    --nav-blur: {{ section.settings.blur_amount }}px;
  }
  
  /* Ocultar en móvil si está configurado */
  {% if section.settings.hide_on_mobile %}
    @media (max-width: 768px) {
      #shopify-section-{{ section.id }} .anchor-navigation {
        display: none;
      }
    }
  {% endif %}
  
  /* Auto-ocultar cuando no se está scrolleando */
  {% if section.settings.auto_hide %}
    #shopify-section-{{ section.id }} .anchor-navigation {
      transition: opacity var(--nav-transition-speed) ease,
                  transform var(--nav-transition-speed) ease;
    }
    
    #shopify-section-{{ section.id }} .anchor-navigation.nav-hidden {
      opacity: 0;
      pointer-events: none;
      transform: translateX({% if section.settings.nav_position == 'fixed-left' %}-20px{% else %}20px{% endif %});
    }
  {% endif %}
  
  /* Barra de progreso de scroll */
  {% if section.settings.show_progress %}
    .scroll-progress-indicator {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: {{ section.settings.progress_height }}px;
      background: rgba(0,0,0,0.1);
      z-index: 9999;
    }
    
    .scroll-progress-bar {
      height: 100%;
      background: {{ section.settings.progress_color }};
      width: 0%;
      transition: width 0.2s ease;
    }
  {% endif %}
  
  /* Efectos de glassmorphism si está activado */
  {% if section.settings.glass_effect %}
    #shopify-section-{{ section.id }} .anchor-navigation {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(var(--nav-blur));
      -webkit-backdrop-filter: blur(var(--nav-blur));
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
  {% endif %}
</style>

{% comment %}
  JavaScript adicional para funcionalidades avanzadas
{% endcomment %}
{% if section.settings.auto_hide or section.settings.show_progress %}
<script>
  (function() {
    const sectionId = '{{ section.id }}';
    
    {% if section.settings.auto_hide %}
    // Auto-ocultar navegación
    let scrollTimer = null;
    const nav = document.querySelector(`#shopify-section-${sectionId} .anchor-navigation`);
    
    function showNav() {
      if (nav) {
        nav.classList.remove('nav-hidden');
        clearTimeout(scrollTimer);
        scrollTimer = setTimeout(() => {
          nav.classList.add('nav-hidden');
        }, {{ section.settings.auto_hide_delay }});
      }
    }
    
    // Mostrar al mover el mouse o hacer scroll
    window.addEventListener('scroll', showNav);
    window.addEventListener('mousemove', showNav);
    
    // Mostrar inicialmente
    showNav();
    {% endif %}
    
    {% if section.settings.show_progress %}
    // Indicador de progreso de scroll
    function updateScrollProgress() {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrollPercent = (scrollTop / scrollHeight) * 100;
      
      const progressBar = document.querySelector(`#shopify-section-${sectionId} .scroll-progress-bar`);
      if (progressBar) {
        progressBar.style.width = scrollPercent + '%';
      }
    }
    
    window.addEventListener('scroll', updateScrollProgress);
    updateScrollProgress();
    {% endif %}
  })();
</script>
{% endif %}

{% comment %}
  Schema: Configuración de la sección en el editor de Shopify
{% endcomment %}
{% schema %}
{
  "name": "🧭 Menú de Navegación por Anclas",
  "class": "anchor-navigation-menu",
  "tag": "section",
  "settings": [
    {
      "type": "header",
      "content": "📍 Posición y Estilo"
    },
    {
      "type": "select",
      "id": "nav_position",
      "label": "Posición del menú",
      "options": [
        {
          "value": "fixed-left",
          "label": "Fijo a la izquierda"
        },
        {
          "value": "fixed-right",
          "label": "Fijo a la derecha"
        },
        {
          "value": "fixed-top",
          "label": "Fijo arriba"
        },
        {
          "value": "fixed-bottom",
          "label": "Fijo abajo"
        }
      ],
      "default": "fixed-right",
      "info": "Dónde aparecerá el menú de navegación"
    },
    {
      "type": "select",
      "id": "nav_style",
      "label": "Estilo visual",
      "options": [
        {
          "value": "dots",
          "label": "Puntos minimalistas"
        },
        {
          "value": "lines",
          "label": "Líneas modernas"
        },
        {
          "value": "buttons",
          "label": "Botones con texto"
        },
        {
          "value": "pills",
          "label": "Píldoras"
        },
        {
          "value": "numbers",
          "label": "Números"
        }
      ],
      "default": "dots",
      "info": "Apariencia visual del menú"
    },
    {
      "type": "checkbox",
      "id": "show_labels",
      "label": "Mostrar etiquetas de texto",
      "default": false,
      "info": "Muestra el nombre de cada sección junto al indicador"
    },
    {
      "type": "header",
      "content": "🎨 Colores y Apariencia"
    },
    {
      "type": "color_background",
      "id": "nav_background",
      "label": "Fondo del menú",
      "default": "linear-gradient(180deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%)"
    },
    {
      "type": "color",
      "id": "nav_color",
      "label": "Color de los elementos",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "nav_active_color",
      "label": "Color del elemento activo",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "nav_hover_color",
      "label": "Color al pasar el mouse",
      "default": "#333333"
    },
    {
      "type": "checkbox",
      "id": "glass_effect",
      "label": "Efecto glassmorphism",
      "default": true,
      "info": "Aplica un efecto de vidrio esmerilado al fondo"
    },
    {
      "type": "range",
      "id": "blur_amount",
      "label": "Cantidad de desenfoque",
      "min": 0,
      "max": 20,
      "step": 1,
      "default": 10,
      "unit": "px",
      "info": "Solo funciona con efecto glassmorphism activo"
    },
    {
      "type": "header",
      "content": "⚙️ Comportamiento"
    },
    {
      "type": "number",
      "id": "header_offset",
      "label": "Offset del header (px)",
      "default": 80,
      "info": "Compensación para headers fijos"
    },
    {
      "type": "range",
      "id": "scroll_duration",
      "label": "Duración del scroll",
      "min": 100,
      "max": 2000,
      "step": 100,
      "default": 600,
      "unit": "ms",
      "info": "Velocidad de la animación de scroll"
    },
    {
      "type": "range",
      "id": "transition_speed",
      "label": "Velocidad de transiciones",
      "min": 100,
      "max": 1000,
      "step": 50,
      "default": 300,
      "unit": "ms"
    },
    {
      "type": "header",
      "content": "📱 Responsive"
    },
    {
      "type": "checkbox",
      "id": "hide_on_mobile",
      "label": "Ocultar en móviles",
      "default": false,
      "info": "Oculta el menú en pantallas menores a 768px"
    },
    {
      "type": "checkbox",
      "id": "auto_hide",
      "label": "Auto-ocultar cuando no se usa",
      "default": false,
      "info": "El menú se oculta automáticamente y aparece al hacer scroll o mover el mouse"
    },
    {
      "type": "range",
      "id": "auto_hide_delay",
      "label": "Retraso para auto-ocultar",
      "min": 1000,
      "max": 10000,
      "step": 500,
      "default": 3000,
      "unit": "ms",
      "info": "Tiempo antes de ocultar el menú"
    },
    {
      "type": "header",
      "content": "📊 Indicador de Progreso"
    },
    {
      "type": "checkbox",
      "id": "show_progress",
      "label": "Mostrar barra de progreso de scroll",
      "default": false,
      "info": "Muestra una barra que indica el progreso de scroll en la página"
    },
    {
      "type": "color",
      "id": "progress_color",
      "label": "Color de la barra de progreso",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "progress_height",
      "label": "Altura de la barra",
      "min": 2,
      "max": 10,
      "step": 1,
      "default": 3,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "ℹ️ Información"
    },
    {
      "type": "paragraph",
      "content": "Este menú se llenará automáticamente con todas las anclas configuradas en las secciones. Asegúrate de agregar bloques de 'Ancla de Sección' a las secciones que quieres incluir en la navegación."
    }
  ],
  "presets": [
    {
      "name": "🧭 Navegación por Anclas - Lateral",
      "settings": {
        "nav_position": "fixed-right",
        "nav_style": "dots",
        "show_labels": false
      }
    },
    {
      "name": "🧭 Navegación por Anclas - Superior",
      "settings": {
        "nav_position": "fixed-top",
        "nav_style": "buttons",
        "show_labels": true
      }
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}